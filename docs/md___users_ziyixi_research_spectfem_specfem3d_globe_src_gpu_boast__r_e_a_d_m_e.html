<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SPECFEM3D GLOBE: BOAST</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SPECFEM3D GLOBE
   &#160;<span id="projectnumber">latest stable release</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">BOAST </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This directory contains source files necessary to generate SPECFEM3D kernels in both CUDA and OpenCL flavor.</p>
<h2>Documentation:</h2>
<p>see:</p>
<p><a href="https://github.com/Nanosim-LIG/boast">https://github.com/Nanosim-LIG/boast</a></p>
<p><a href="http://www.rubydoc.info/github/Nanosim-LIG/boast/master">http://www.rubydoc.info/github/Nanosim-LIG/boast/master</a></p>
<h2>Quick start:</h2>
<ol type="1">
<li><p class="startli">Installation requires ruby: on Linux, e.g.: </p><div class="fragment"><div class="line">sudo apt-get install ruby ruby-dev</div></div><!-- fragment --><p class="startli">on Mac, e.g. : </p><div class="fragment"><div class="line">fink install ruby</div></div><!-- fragment --><p> or </p><div class="fragment"><div class="line">sudo port install ruby</div></div><!-- fragment --></li>
<li>install BOAST: <div class="fragment"><div class="line">gem install --user-install BOAST</div></div><!-- fragment --> or <div class="fragment"><div class="line">sudo gem install BOAST</div></div><!-- fragment --></li>
<li>update BOAST: <div class="fragment"><div class="line">sudo gem update BOAST</div></div><!-- fragment --></li>
</ol>
<h6>BOAST help:</h6>
<p>/Library/Ruby/Gems/2.0.0/doc/BOAST-2.0.1/rdoc/index.html /Library/Ruby/Gems/2.0.0/gems/BOAST-2.0.1/README.md</p>
<h6>Testing installation with interactive ruby:</h6>
<div class="fragment"><div class="line">&gt; irb</div><div class="line">irb(main):003:0&gt; require &#39;BOAST&#39;</div><div class="line">irb(main):003:0&gt; a = BOAST::Int &quot;a&quot;</div><div class="line">irb(main):003:0&gt; &lt;ctrl-D&gt;</div></div><!-- fragment --><h2>CUDA/OpenCL kernel generation:</h2>
<p>Type: </p><div class="fragment"><div class="line">cd ~/SPECFEM3D_GLOBE</div><div class="line">make boast</div></div><!-- fragment --><p> or </p><div class="fragment"><div class="line">cd SPECFEM3D_GLOBE/src/gpu/boast</div><div class="line">ruby kernels.rb -o ../kernels.gen</div></div><!-- fragment --><p>Using ruby, you can regenerate the list of kernels. You might need to create an "output" directory in this folder during development. so: </p><div class="fragment"><div class="line">cd SPECFEM3D_GLOBE/src/gpu/boast/</div><div class="line">mkdir output</div><div class="line">ruby kernels.rb</div></div><!-- fragment --><p>will generate the kernels in the output/ directory.</p>
<h2>Testing</h2>
<p>If non regression data are installed in specfem3d_globe/src/gpu/kernels.test/ then you can test the kernels by </p><div class="fragment"><div class="line">ruby kernels.rb -c</div></div><!-- fragment --><p>This will use the non regression testing data to give you information about the behavior of the kernels (accuracy and performance). If tests are not installed, it will just compile the kernels and check for compilation errors.</p>
<p>You might have to manually deactivate CUDA kernels test: </p><div class="fragment"><div class="line">diff --git a/src/gpu/boast/kernels.rb b/src/gpu/boast/kernels.rb</div><div class="line">index 4d2b31d..e4a678f 100644</div><div class="line">--- a/src/gpu/boast/kernels.rb</div><div class="line">+++ b/src/gpu/boast/kernels.rb</div><div class="line">@@ -76,7 +76,7 @@ kernels = [</div><div class="line"> :compute_iso_undoatt_kernel</div><div class="line"> ]</div><div class="line"></div><div class="line">-langs = [ :CUDA, :CL]</div><div class="line">+langs = [:CL]</div><div class="line"> BOAST::set_default_real_size(4)</div><div class="line"> BOAST::set_replace_constants(false)</div><div class="line"> class Float</div></div><!-- fragment --><p>If you want Intel vectorization report you can execute BOAST in verbose mode: </p><div class="fragment"><div class="line">VERBOSE=true ruby kernels.rb -c</div></div><!-- fragment --><p> or use different CL flags: </p><div class="fragment"><div class="line">CLFLAGS=-cl-fast-relaxed-math ruby kernels.rb -c</div></div><!-- fragment --><p>That should be the default in SPECFEM3D (even if for now if seems the default is no flags for OpenCL, which gives a certain advantage to CUDA).</p>
<p>If you have a problem of platform selection or want to restrict the test to 1 kernel: </p><div class="fragment"><div class="line">ruby kernels.rb -c -k crust_mantle_impl_kernel_forward -p INTEL</div></div><!-- fragment --><p>Once you want to test your kernels in SPECFEM3D then you can </p><div class="fragment"><div class="line">ruby kernels.rb -c -o ../kernels.gen/</div></div><!-- fragment --><p>At this point you may need to reactivate CUDA support in order to have all the files correctly generated (never tested without CUDA kernels being generated) </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
